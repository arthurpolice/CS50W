{% extends 'auctions/layout.html' %}
{% load humanize %}

{% block body %}
    <div id="listing-top-part">
        <div id="listing-carousel" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                  <img class="d-block w-100" src="{{ info.0.image_1 }}" alt="First slide">
                </div>
                <div class="carousel-item">
                  <img class="d-block w-100" src="{{ info.0.image_2 }}" alt="Second slide">
                </div>
                <div class="carousel-item">
                  <img class="d-block w-100" src="{{ info.0.image_3 }}" alt="Third slide">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="{{ info.0.image_4 }}" alt="Fourth slide">
                  </div>
                  <div class="carousel-item">
                    <img class="d-block w-100" src="{{ info.0.image_5 }}" alt="Fifth slide">
                  </div>
            </div>
            <a class="carousel-control-prev" href="#listing-caroussel" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            </a>
            <a class="carousel-control-next" href="#listing-caroussel" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
            </a>
        </div>
        <div id="listing-purchase-menu">
            <div id="listing-page-header">
                <h2 id="listing-page-title">{{ info.0.title }}</h2>
                {% if info.0.listing_owner == current_user %}
                <form id="listing-closing-form" action="{% url 'close_listing' %}" method="post">
                    <input name="listing_id" readonly value="{{ info.0.id }}" class="hidden">
                    <button class="btn btn-secondary" form="listing-closing-form">End</button>
                    {% csrf_token %}
                </form>
                {% else %}
                <form id="listing-closing-form" method="post">
                    <input name="listing_id" readonly value="{{ info.0.id }}" class="hidden">
                    {% if watchlist_check == False %}
                        <button class="btn btn-secondary" form="listing-closing-form" formaction="{% url 'save_watchlist' %}">Watch</button>
                    {% else %}
                        <button class="btn btn-secondary" form="listing-closing-form" formaction="{% url 'remove_watchlist' %}">Unwatch</button>
                    {% endif %}
                    {% csrf_token %}
                </form>
                {% endif %}
            </div>
            <div>
                <p>Highest Bid: ${{ info.0.highest_bid|floatformat:2|intcomma }} {% if info.0.winning_user %} by {{ info.0.winning_user }} {% endif %}</p>
                {% if info.0.buyout %}
                <p>Buyout: ${{ info.0.buyout|floatformat:2|intcomma }}</p>
                {% endif %}
            </div>
            <div id="purchase-form-wrapper">
                {% if info.0.listing_status == "Open" %}
                <form id="buy-form" class="hidden" method="post">
                    <input name="highest_bid" type="number" step="2" class="hidden" value="{{ info.0.highest_bid }}">
                    <input name="buyout" type="number" step="2" class="hidden" value="{{ info.0.buyout }}">
                    <input name="listing_id" readonly value="{{ info.0.id }}" class="hidden">
                    {% csrf_token %}
                </form>
                <form id="purchase-form" method="post">
                    {{ purchase_form.bid_field }}
                    <input name="highest_bid" type="number" step="2" class="hidden" value="{{ info.0.highest_bid }}">
                    <input name="buyout" type="number" step="2" class="hidden" value="{{ info.0.buyout }}">
                    <input name="listing_id" readonly value="{{ info.0.id }}" class="hidden">
                    {% csrf_token %}
                </form>
                <div id="form-buttons">
                    <button type="submit" class="btn btn-secondary" form="purchase-form" formaction="{% url 'bid' %}">Bid</button>
                    {% if info.0.buyout %}
                    <button type="submit" class="btn btn-secondary" form="buy-form" formaction="{% url 'buy' %}">Buy</button>
                    {% endif %}
                    <p>{{ error }}</p>
                </div>
                {% else %}
                    {% if info.0.winning_user != None %}
                        <p>The winner of this auction is: {{ info.0.winning_user }}!</p>
                    {% else %}
                        <p>This auction expired with no winners.</p>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    <div id="description-wrapper">
        <div id="listing-description">
            <h2>Details</h2>
            <p>Seller: {{ info.0.listing_owner }}</p>
            <p>Created in: {{ info.0.listing_day }} at {{ info.0.listing_time }}</p>
            <p>{{ info.0.description }}</p>
        </div>
    </div>
    <div id="comments-area">
        {% if request.user.is_authenticated %}
        <form id="comment-form" method="post" action="{% url 'log_comment' %}">
            <div id="comment-input-wrapper">
                <textarea name="comment_content" id="comment-input"></textarea>
            </div>
            <input name="listing_id" class="hidden" value="{{ info.0.id }}" readonly>
            <div id="btn-wrapper">
                <button type="submit" class="btn btn-secondary">Comment</button>
            </div>
            {% csrf_token %}
        </form>
        {% endif %}
        <div id="comments">
            {% for comment in comments %}
                <div class="comment-wrapper card bg-light">
                    <div class="user-info-comments card-header">
                        <h5 class="username">{{ comment.author }}</h5>
                        <h6 class="comment-time">{{ comment.comment_day }} - {{ comment.comment_time }}</h6>
                    </div>
                    <div class="comment-content-wrapper">
                        <p>{{ comment.comment }}</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}